<!DOCTYPE HTML>
<html lang="en"><head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <title>Performance Testing Game Sprites using HTML5 Canvas</title>
</head><body>
<canvas id="main" width="800" height="600">This demo requires canvas support.</canvas>
<script type="text/javascript" charset="utf-8">
var ctx;
var width;
var height;
var delta;
var lastTime;
var frames;
var totalTime;
var updateTime;
var updateFrames;
var creats = new Array();

var numupdates=0;

function init() {
//console.log("Hello")
//alert("Inside init")
    var canvas =document.getElementById('main');

//alert(canvas)
    width = canvas.width;
    height = canvas.height;
    ctx = canvas.getContext('2d');
    for(var i=0; i < 10; ++i) {
        //alert("Adding creature: "+ i)
        addCreature();
    }
    lastTime = (new Date()).getTime();
    frames = 0;
    totalTime = 0;
    updateTime = 0;
    updateFrames =0;
    setInterval(update(), 10);

    for(var j=0; j < 10; j++) {
        //alert("Calling update: "+ j)
        update();
        //wait(100);
    }
}


function addCreature() {
    var c = new Creature(Math.random()*100,Math.random()*200);
    creats.push(c);
}

function update() {
    //alert("Inside update")
    //alert("Num update: "+ numupdates);
    var now = (new Date()).getTime();
    delta = now-lastTime;

    //alert("numupdate: " + numupdates + "   delta: " + delta)
    numupdates++;

    lastTime = now;
    totalTime+=delta;
    frames++;
    updateTime+=delta;
    updateFrames++;
    if(updateTime > 1000) {
        //alert("Greater than 1000: "+ numupdates)
        //document.getElementById('fps').innerHTML = "FPS AVG: " + (1000*frames/totalTime) + " CUR: " + (1000*updateFrames/updateTime);
        updateTime = 0;
        updateFrames =0;
        //alert("stats: " + frames + " & " + totalTime)
    }

    for(var i=0; i < creats.length; ++i) {
        creats[i].move();
    }

    draw();
}

function draw() {
//alert("Inside draw")
    ctx.clearRect(0,0,width,height);
    creats.forEach(drawCreat);
}

function drawCreat(c,i,a) {
    if (!onScreen(c)) {
        return;
    }
    ctx.fillStyle = "#00A308";
    ctx.beginPath();
    ctx.arc(c.x, c.y, 10, 0, Math.PI*2, true);
    ctx.closePath();
    ctx.fill();
}

function onScreen(o) {
    return o.x >= 0 && o.y >= 0 && o.x <= width && o.y <=height;
}

function Creature(x1,y) {
    this.x = x1;
    this.y = y;

    this.dx = Math.random()*2;
    this.dy = Math.random()*2;

    this.move = function() {
        this.x+=this.dx;
        this.y+=this.dy;
        if(this.x < 0 || this.x > width) {
            this.dx*=-1;
        }
        if(this.y < 0 || this.y > height) {
            this.dy*=-1;
        }
    }

}

init();
function frameRate()
{
    var fpsval = 1000*frames/totalTime ;
   // alert("fps value: " +fpsval)

   return (1000*frames/totalTime);
}
</script>
</body></html>
